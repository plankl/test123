<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>üöí Feuerwehr Hydrantenkarte Hamberg</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#d40000">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  
  <style>
    /* ========== GRUNDLEGENDE STYLES ========== */
    * { 
      box-sizing: border-box; 
      touch-action: manipulation;
    }
    
    html, body { 
      margin: 0; 
      padding: 0; 
      height: 100vh; 
      width: 100vw;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
    }
    
    /* ========== KARTEN-CONTAINER ========== */
    #map-container { 
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      z-index: 1;
    }
    
    #map { 
      width: 100%;
      height: 100%;
    }
    
    /* ========== TITEL ========== */
    .map-title { 
      position: fixed; 
      top: 10px; 
      left: 50%; 
      transform: translateX(-50%); 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      padding: 8px 16px; 
      font-size: 16px; 
      font-weight: 600; 
      border-radius: 8px; 
      z-index: 1001;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    /* ========== KONTROLLEN SIDEBAR (RECHTS) ========== */
    .controls-sidebar { 
      position: fixed; 
      right: 10px; 
      top: 50%; 
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 1000;
    }
    
    .control-btn { 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      border: none;
      border-radius: 8px; 
      padding: 8px;
      cursor: pointer; 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      user-select: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      min-width: 60px;
    }
    
    .control-btn .icon {
      font-size: 20px;
      margin-bottom: 2px;
    }
    
    .control-btn .label {
      font-size: 10px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .control-btn:hover { 
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    
    .control-btn:active {
      transform: scale(0.95);
    }
    
    .control-btn.active { 
      background: #4CAF50; 
      color: white; 
    }
    
    /* ========== LEGENDE (LINKS UNTEN) ========== */
    .legend-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      min-width: 200px;
      max-width: 280px;
    }
    
    .legend-header {
      padding: 10px 12px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    
    .legend-header:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .toggle-icon {
      transition: transform 0.3s ease;
      font-size: 12px;
    }
    
    .legend-content {
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
      transition: all 0.3s ease;
    }
    
    .legend-content.collapsed {
      max-height: 0;
      padding: 0 10px;
      overflow: hidden;
    }
    
    .legend-filters {
      padding-bottom: 8px;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .legend-items {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 4px 0;
    }
    
    .legend-icon {
      width: 20px;
      height: 20px;
      object-fit: contain;
    }
    
    .filter-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 13px;
      user-select: none;
      flex: 1;
    }
    
    .filter-checkbox input[type="checkbox"] {
      cursor: pointer;
    }
    
    .filter-checkbox:hover {
      color: #4CAF50;
    }
    
    /* ========== STATUS CONTAINER (RECHTS UNTEN) ========== */
    .status-container { 
      position: fixed; 
      bottom: 20px; 
      right: 10px; 
      display: flex;
      flex-direction: column;
      gap: 6px;
      z-index: 1000;
      align-items: flex-end;
    }
    
    .status-indicator { 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(10px);
      color: white;
      padding: 6px 12px; 
      border-radius: 15px; 
      font-size: 12px; 
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    /* ========== OFFLINE INDIKATOR ========== */
    .offline-indicator {
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff9800;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 8000;
      display: none;
    }
    
    .offline-indicator.visible {
      display: block;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.05); }
    }
    
    /* ========== POPUPS ========== */
    .leaflet-popup-content-wrapper {
      background: rgba(255,255,255,0.95) !important;
      backdrop-filter: blur(10px);
      border-radius: 8px !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2) !important;
    }
    
    .leaflet-popup-content {
      margin: 12px 16px !important;
      font-size: 13px;
      line-height: 1.4;
    }
    
    .leaflet-popup-tip {
      background: rgba(255,255,255,0.95) !important;
    }
    
    /* ========== MOBILE ANPASSUNGEN ========== */
    @media (max-width: 768px) {
      .map-title { 
        font-size: 14px; 
        padding: 6px 12px;
      }
      
      .controls-sidebar { 
        right: 8px; 
        gap: 6px;
      }
      
      .control-btn { 
        min-width: 55px;
        padding: 6px;
      }
      
      .control-btn .icon {
        font-size: 18px;
      }
      
      .control-btn .label {
        font-size: 9px;
      }
      
      .legend-container {
        bottom: 15px;
        left: 15px;
        max-width: 240px;
        font-size: 12px;
      }
      
      .status-container {
        bottom: 15px;
        right: 8px;
      }
      
      .status-indicator {
        font-size: 11px;
        padding: 5px 10px;
      }
    }
    
    @media (max-width: 480px) {
      .legend-container {
        max-width: 200px;
      }
      
      .control-btn {
        min-width: 50px;
      }
      
      .control-btn .icon {
        font-size: 16px;
      }
      
      .control-btn .label {
        font-size: 8px;
      }
    }
  </style>
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(console.error);
    }
  </script>
</head>

<body>
  <!-- ========== HAUPTCONTAINER ========== -->
  <div id="map-container">
    <div id="map"></div>
  </div>
  
  <!-- ========== TITEL ========== -->
  <div class="map-title">üöí Hydrantenkarte Feuerwehr Hamberg</div>
  
  <!-- ========== OFFLINE INDIKATOR ========== -->
  <div class="offline-indicator" id="offline-indicator">
    üì° Offline-Modus
  </div>

  <!-- ========== KONTROLLEN (RECHTS) ========== -->
  <div class="controls-sidebar">
    <button class="control-btn" onclick="toggleFlashlight()" id="flashlight-toggle" title="Taschenlampe">
      <span class="icon">üî¶</span>
      <span class="label">Licht</span>
    </button>
    <button class="control-btn" onclick="findNearestHydrant()" title="N√§chster Hydrant">
      <span class="icon">üîç</span>
      <span class="label">N√§chster</span>
    </button>
    <button class="control-btn" onclick="gotoUserLocation()" title="Meine Position">
      <span class="icon">üìç</span>
      <span class="label">Position</span>
    </button>
    <button class="control-btn" onclick="toggleTheme()" title="Karte wechseln">
      <span class="icon">üó∫Ô∏è</span>
      <span class="label">Karte</span>
    </button>
    <button class="control-btn" onclick="toggleCompass()" id="compass-toggle" title="Kompass">
      <span class="icon">üß≠</span>
      <span class="label">Kompass</span>
    </button>
    <button class="control-btn" onclick="captureScreenshot()" title="Teilen">
      <span class="icon">üì§</span>
      <span class="label">Teilen</span>
    </button>
  </div>

  <!-- ========== LEGENDE (LINKS UNTEN) ========== -->
  <div class="legend-container" id="legend-container">
    <div class="legend-header" onclick="toggleLegend()">
      <span>üìã Legende</span>
      <span class="toggle-icon" id="legend-toggle-icon">‚ñº</span>
    </div>
    <div class="legend-content" id="legend-content">
      <div class="legend-filters">
        <label class="filter-checkbox">
          <input type="checkbox" id="filter-all" checked onchange="toggleAllFilters(this)">
          <span>Alle anzeigen</span>
        </label>
      </div>
      <div class="legend-items">
        <div class="legend-item">
          <img src="icons/red-dot.png" alt="√úberflur" class="legend-icon">
          <label class="filter-checkbox">
            <input type="checkbox" data-type="√ºberflurhydrant" checked onchange="filterMarkers()">
            <span>√úberflurhydrant</span>
          </label>
        </div>
        <div class="legend-item">
          <img src="icons/blue-dot.png" alt="Unterflur" class="legend-icon">
          <label class="filter-checkbox">
            <input type="checkbox" data-type="unterflurhydrant" checked onchange="filterMarkers()">
            <span>Unterflurhydrant</span>
          </label>
        </div>
        <div class="legend-item">
          <img src="icons/green-dot.png" alt="Rettungspunkt" class="legend-icon">
          <label class="filter-checkbox">
            <input type="checkbox" data-type="rettungspunkt" checked onchange="filterMarkers()">
            <span>Rettungspunkt</span>
          </label>
        </div>
        <div class="legend-item">
          <img src="icons/yellow-dot.png" alt="Wasserbeh√§lter" class="legend-icon">
          <label class="filter-checkbox">
            <input type="checkbox" data-type="wasserbeh√§lter" checked onchange="filterMarkers()">
            <span>Wasserbeh√§lter</span>
          </label>
        </div>
        <div class="legend-item">
          <img src="icons/purple-dot.png" alt="Sperrpunkt" class="legend-icon">
          <label class="filter-checkbox">
            <input type="checkbox" data-type="sperrpunkt" checked onchange="filterMarkers()">
            <span>Sperrpunkt</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== STATUS (RECHTS UNTEN) ========== -->
  <div class="status-container">
    <div class="status-indicator" id="gps-indicator">
      <span id="gps-icon">üü°</span>
      <span id="gps-accuracy">GPS: --</span>
    </div>
    <div class="status-indicator" id="altitude-indicator">
      <span>üìè</span>
      <span id="altitude-value">-- m</span>
    </div>
    <div class="status-indicator" id="degree-indicator">
      <span>üß≠</span>
      <span id="degree-value">0¬∞</span>
    </div>
    <div class="status-indicator" id="wind-indicator">
      <span>üí®</span>
      <span id="wind-value">-- km/h</span>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

// ============================================================================
// MODUL: ERROR HANDLING
// ============================================================================
window.addEventListener('error', (e) => {
  console.error('App-Fehler:', e.error);
  return true; // App l√§uft weiter
});

window.addEventListener('unhandledrejection', (e) => {
  console.error('Promise-Fehler:', e.reason);
  e.preventDefault();
});

// ============================================================================
// MODUL: KARTEN-INITIALISIERUNG
// ============================================================================
var osmStandard = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { 
  attribution: '¬© OpenStreetMap | 10.08.2025',
  maxZoom: 19
});

var osmDark = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', { 
  attribution: '¬© CartoDB',
  maxZoom: 19
});

var topoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenTopoMap',
  maxZoom: 17
});

var satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
  attribution: '¬© Esri',
  maxZoom: 18
});

// Karte initialisieren
var map = L.map('map', { 
  center: [49.10951, 11.68453], 
  zoom: 15, 
  layers: [osmStandard],
  zoomControl: true,
  attributionControl: true
});

// ============================================================================
// MODUL: GLOBALE VARIABLEN
// ============================================================================
let userMarker, cone, accuracyCircle, nearestHydrantLine;
let compassActive = false;
let flashlightActive = false;
let flashlightStream = null;
let currentHeading = 0;
let currentAltitude = null;
let currentAccuracy = null;
let isOffline = !navigator.onLine;
let watchId = null;
let isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
let hydrantMarkers = [];
let userPosition = null;
let currentThemeIndex = 0;
const themes = [osmStandard, osmDark, topoMap, satellite];
const themeNames = ['Standard', 'Dunkel', 'Gel√§nde', 'Satellit'];

// Neue Variablen f√ºr Fixes
let userHasControl = false;
let hydrantLineTimer = null;
let orientationHandler = null;
let windArrow = null;
let windData = { speed: null, direction: null, degrees: null };
let lastWindUpdate = 0;

// ============================================================================
// MODUL: USER CONTROL TRACKING
// ============================================================================
map.on('dragstart', () => { 
  userHasControl = true;
});

map.on('zoomstart', () => { 
  userHasControl = true;
});

// ============================================================================
// MODUL: HYDRANTENMARKER AUS CSV
// ============================================================================

        var marker = L.marker([49.10951, 11.68453], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Feuerwehrhaus<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10951,11.68453' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10951,11.68453' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10895, 11.68544], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Sch√∂ndorfer Str. 5<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10895,11.68544' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10895,11.68544' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10803, 11.68614], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Zum Spitzberg 3<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10803,11.68614' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10803,11.68614' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10752, 11.68542], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Kreuzung Zum Spitzberg / R√∂thenweg<br>Nenndurchmesser DN: 125.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10752,11.68542' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10752,11.68542' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10815, 11.68443], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant R√∂thenweg 13<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10815,11.68443' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10815,11.68443' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10693, 11.68444], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Zum Spitzberg 10<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10693,11.68444' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10693,11.68444' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10738, 11.68313], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Sonnenring 14<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10738,11.68313' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10738,11.68313' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10664, 11.68528], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Kiefergasse 5<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10664,11.68528' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10664,11.68528' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10597, 11.68546], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Rascher Str. 13<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10597,11.68546' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10597,11.68546' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1055, 11.68611], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Rascher Str. 9<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1055,11.68611' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1055,11.68611' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10605, 11.6862], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant R√∂thenweg 6<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10605,11.6862' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10605,11.6862' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10668, 11.68604], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant R√∂thenweg<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10668,11.68604' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10668,11.68604' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10786, 11.68775], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 17<br>Nenndurchmesser DN: 125.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10786,11.68775' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10786,11.68775' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1068, 11.68672], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Hauptstra√üe 28<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1068,11.68672' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1068,11.68672' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1063, 11.68724], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 21b<br>Nenndurchmesser DN: 125.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1063,11.68724' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1063,11.68724' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10557, 11.68756], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 25<br>Nenndurchmesser DN: 125.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10557,11.68756' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10557,11.68756' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10483, 11.68749], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Hauptstra√üe 29<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10483,11.68749' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10483,11.68749' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10502, 11.68894], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Herrnrieder Str. 2<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10502,11.68894' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10502,11.68894' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10279, 11.68877], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Eichlberger Str. 12<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10279,11.68877' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10279,11.68877' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10373, 11.6877], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Eichlberger Str. 3<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10373,11.6877' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10373,11.6877' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1043, 11.68642], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 35<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1043,11.68642' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1043,11.68642' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10412, 11.68603], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 37<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10412,11.68603' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10412,11.68603' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10355, 11.68542], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 41<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10355,11.68542' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10355,11.68542' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10372, 11.68505], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 46<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10372,11.68505' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10372,11.68505' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10288, 11.68749], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Eichlberger Str. 12<br>Nenndurchmesser DN: 125.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10288,11.68749' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10288,11.68749' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10367, 11.68839], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Eichlberger Str. 4<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10367,11.68839' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10367,11.68839' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11046, 11.67008], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant √ñdberg 1<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11046,11.67008' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11046,11.67008' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11063, 11.67348], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant √ñdberg 3<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11063,11.67348' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11063,11.67348' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1111, 11.67341], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant √ñdberg 4<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1111,11.67341' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1111,11.67341' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11035, 11.6837], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Sportplatz<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11035,11.6837' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11035,11.6837' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11208, 11.68469], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Kreuzung Reitstra√üe/Spanbergweg<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11208,11.68469' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11208,11.68469' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11304, 11.68592], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Gabelung Reitstra√üe/Winner Str.<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11304,11.68592' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11304,11.68592' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11292, 11.68668], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Bush√§uschen Schn√∂dorf<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11292,11.68668' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11292,11.68668' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11328, 11.68606], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Winner Str. 1<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11328,11.68606' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11328,11.68606' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11447, 11.6874], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Winner Str. 6<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11447,11.6874' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11447,11.6874' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11339, 11.68766], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Reitstra√üe 20<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11339,11.68766' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11339,11.68766' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11098, 11.68577], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hohe Trift 5<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11098,11.68577' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11098,11.68577' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11124, 11.68644], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hohe Trift 2, Einm√ºndung Spanbergweg<br>Nenndurchmesser DN: 150.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11124,11.68644' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11124,11.68644' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11065, 11.68653], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 1<br>Nenndurchmesser DN: 150.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11065,11.68653' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11065,11.68653' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11, 11.68699], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Hauptstra√üe 3<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11,11.68699' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11,11.68699' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.1091, 11.68704], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Hauptstra√üe 10<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.1091,11.68704' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.1091,11.68704' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10941, 11.68767], {
            icon: L.icon({
                iconUrl: 'icons/yellow-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Wasserbeh√§lter</b><br>L√∂schwasserbeh√§lter Talweg, Einm√ºndung Pfarrgasse<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10941,11.68767' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10941,11.68767' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'wasserbeh√§lter';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10881, 11.68816], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Pfarrgasse 4<br>Nenndurchmesser DN: 100.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10881,11.68816' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10881,11.68816' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11375, 11.69697], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Rofen<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11375,11.69697' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11375,11.69697' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11399, 11.69562], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Rofen<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11399,11.69562' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11399,11.69562' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10078, 11.68323], {
            icon: L.icon({
                iconUrl: 'icons/red-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>√úberflurhydrant</b><br>√úberflurhydrant Ziegelh√ºtte 1<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10078,11.68323' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10078,11.68323' target='_blank'>Google Maps</a>`);
        marker.hydrantType = '√ºberflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10849, 11.68725], {
            icon: L.icon({
                iconUrl: 'icons/blue-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Unterflurhydrant</b><br>Unterflurhydrant Kirche<br>Nenndurchmesser DN: 80.0 mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10849,11.68725' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10849,11.68725' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'unterflurhydrant';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.092199, 11.70373], {
            icon: L.icon({
                iconUrl: 'icons/green-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>Rettungspunkt Schafsee Hamberg/Eichlberg<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.092199,11.70373' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.092199,11.70373' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'rettungspunkt';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.086695, 11.66433953], {
            icon: L.icon({
                iconUrl: 'icons/green-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>Rettungspunkt NM-2131 Langenthonhausen<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.086695,11.66433953' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.086695,11.66433953' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'rettungspunkt';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.10529568, 11.716126], {
            icon: L.icon({
                iconUrl: 'icons/green-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>Rettungspunkt Feuerwehrhaus Herrnried<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.10529568,11.716126' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.10529568,11.716126' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'rettungspunkt';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.11173709, 11.66721575], {
            icon: L.icon({
                iconUrl: 'icons/green-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>Rettungspunkt NM-2171 √ñdberg<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.11173709,11.66721575' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.11173709,11.66721575' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'rettungspunkt';
        hydrantMarkers.push(marker);
        var marker = L.marker([49.12040024, 11.71188973], {
            icon: L.icon({
                iconUrl: 'icons/green-dot.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32]
            })
        }).addTo(map).bindPopup(`<b>Rettungspunkt</b><br>Rettungspunkt NM-2189 B8 Parkplatz<br>Nenndurchmesser DN: nan mm<br>FF Hamberg<br><a href='https://maps.apple.com/?daddr=49.12040024,11.71188973' target='_blank'>Apple Karten</a><br><a href='https://maps.google.com/?daddr=49.12040024,11.71188973' target='_blank'>Google Maps</a>`);
        marker.hydrantType = 'rettungspunkt';
        hydrantMarkers.push(marker);

// ============================================================================
// MODUL: LEGENDE UND FILTER
// ============================================================================
function toggleLegend() {
  const content = document.getElementById('legend-content');
  const icon = document.getElementById('legend-toggle-icon');
  
  if (content.classList.contains('collapsed')) {
    content.classList.remove('collapsed');
    icon.textContent = '‚ñº';
  } else {
    content.classList.add('collapsed');
    icon.textContent = '‚ñ∂';
  }
}

function toggleAllFilters(checkbox) {
  const checkboxes = document.querySelectorAll('.legend-items input[type="checkbox"]');
  checkboxes.forEach(cb => {
    cb.checked = checkbox.checked;
  });
  filterMarkers();
}

function filterMarkers() {
  const checkboxes = document.querySelectorAll('.legend-items input[type="checkbox"]');
  const activeTypes = [];
  
  checkboxes.forEach(cb => {
    if (cb.checked) {
      activeTypes.push(cb.dataset.type);
    }
  });
  
  hydrantMarkers.forEach(marker => {
    if (activeTypes.includes(marker.hydrantType)) {
      marker.addTo(map);
    } else {
      marker.remove();
    }
  });
  
  // "Alle anzeigen" Checkbox aktualisieren
  const allCheckbox = document.getElementById('filter-all');
  allCheckbox.checked = activeTypes.length === checkboxes.length;
}

// ============================================================================
// MODUL: THEME-WECHSEL
// ============================================================================
function toggleTheme() {
  // Aktuelles Theme entfernen
  map.removeLayer(themes[currentThemeIndex]);
  
  // N√§chstes Theme
  currentThemeIndex = (currentThemeIndex + 1) % themes.length;
  map.addLayer(themes[currentThemeIndex]);
  
  // Optional: Theme-Name anzeigen
  console.log('Karte gewechselt zu:', themeNames[currentThemeIndex]);
}

// ============================================================================
// MODUL: TASCHENLAMPE
// ============================================================================
async function toggleFlashlight() {
  const toggleBtn = document.getElementById('flashlight-toggle');
  
  try {
    if (!flashlightActive) {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: 'environment' }
      });
      
      const track = stream.getVideoTracks()[0];
      const capabilities = track.getCapabilities();
      
      if (capabilities.torch) {
        await track.applyConstraints({
          advanced: [{ torch: true }]
        });
        
        flashlightStream = stream;
        flashlightActive = true;
        toggleBtn.classList.add('active');
      } else {
        throw new Error('Taschenlampe nicht verf√ºgbar');
      }
    } else {
      if (flashlightStream) {
        const track = flashlightStream.getVideoTracks()[0];
        await track.applyConstraints({
          advanced: [{ torch: false }]
        });
        
        flashlightStream.getTracks().forEach(track => track.stop());
        flashlightStream = null;
      }
      
      flashlightActive = false;
      toggleBtn.classList.remove('active');
    }
  } catch (error) {
    console.error('Taschenlampe-Fehler:', error);
    alert('Taschenlampe ist auf diesem Ger√§t nicht verf√ºgbar');
  }
}

// ============================================================================
// MODUL: GPS UND POSITION
// ============================================================================
function gotoUserLocation() {
  userHasControl = false; // Auto-Follow wieder aktivieren
  if (userMarker) {
    map.setView(userMarker.getLatLng(), 17);
  } else {
    startLocationTracking();
  }
}

function startLocationTracking() {
  if ("geolocation" in navigator) {
    const options = {
      enableHighAccuracy: true,
      timeout: 30000, // Erh√∂ht von 10000
      maximumAge: 30000
    };
    
    watchId = navigator.geolocation.watchPosition(
      onLocationSuccess,
      onLocationError,
      options
    );
  } else {
    alert('GPS wird auf diesem Ger√§t nicht unterst√ºtzt');
  }
}

function onLocationSuccess(position) {
  const lat = position.coords.latitude;
  const lng = position.coords.longitude;
  const accuracy = position.coords.accuracy;
  const altitude = position.coords.altitude;
  
  userPosition = { lat, lng };
  currentAccuracy = Math.round(accuracy);
  
  // GPS-Status aktualisieren
  updateGPSStatus(accuracy);
  
  // H√∂he aktualisieren
  if (altitude !== null && altitude !== undefined) {
    currentAltitude = Math.round(altitude);
    document.getElementById('altitude-value').textContent = `${currentAltitude} m`;
  }
  
  // Position auf Karte aktualisieren
  updateUserPositionOnMap(lat, lng, accuracy);
  
  // Karte nur zentrieren wenn User keine Kontrolle hat
  if (!userHasControl && !watchId) {
    map.setView([lat, lng], 17);
  }
  
  // Wind-Daten sofort aktualisieren (force)
  updateWindData(true);
}

function updateGPSStatus(accuracy) {
  const gpsIcon = document.getElementById('gps-icon');
  const gpsAccuracy = document.getElementById('gps-accuracy');
  
  if (accuracy < 10) {
    gpsIcon.textContent = 'üü¢';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  } else if (accuracy < 50) {
    gpsIcon.textContent = 'üü°';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  } else {
    gpsIcon.textContent = 'üî¥';
    gpsAccuracy.textContent = `GPS: ${Math.round(accuracy)}m`;
  }
}

function updateUserPositionOnMap(lat, lng, accuracy) {
  // Alte Marker entfernen
  if (userMarker) map.removeLayer(userMarker);
  if (cone) map.removeLayer(cone);
  if (accuracyCircle) map.removeLayer(accuracyCircle);
  
  // Genauigkeitskreis
  accuracyCircle = L.circle([lat, lng], {
    radius: accuracy,
    color: '#4285f4',
    fillColor: '#4285f4',
    fillOpacity: 0.1,
    weight: 1
  }).addTo(map);
  
  // Benutzer-Marker
  userMarker = L.circleMarker([lat, lng], { 
    radius: 8, 
    color: '#4285f4', 
    fillColor: '#4285f4', 
    fillOpacity: 0.8,
    weight: 2
  }).addTo(map).bindPopup(`
    <b>üöí Meine Position</b><br>
    üìç ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>
    ${currentAltitude ? `üìè H√∂he: ${currentAltitude} m<br>` : ''}
    üéØ Genauigkeit: ${Math.round(accuracy)} m<br>
    üß≠ Richtung: ${Math.round(currentHeading)}¬∞ (${degreesToCardinal(currentHeading)})<br>
    ${windData.speed !== null && windData.degrees !== null
      ? `üí® Wind: ${windData.speed} km/h aus ${getWindDirection(windData.degrees)} (${windData.degrees}¬∞)<br>`
      : ''}
  `);
  
  // Richtungskegel
  cone = L.polygon(getConePoints([lat, lng], currentHeading), { 
    color: '#ff6b35', 
    fillColor: '#ff6b35', 
    fillOpacity: 0.3, 
    weight: 2 
  }).addTo(map);
  
  // Wind-Pfeil aktualisieren
  updateWindArrow();
}

function onLocationError(error) {
  console.error('GPS-Fehler:', error);
  const gpsIcon = document.getElementById('gps-icon');
  const gpsAccuracy = document.getElementById('gps-accuracy');
  gpsIcon.textContent = '‚ùå';
  gpsAccuracy.textContent = 'GPS: Fehler';
}

function getConePoints(center, angleDeg, radius = 40, spread = 45) {
  const [lat, lng] = center;
  const angleRad = (angleDeg * Math.PI) / 180;
  const spreadRad = (spread * Math.PI) / 180;
  const points = [[lat, lng]];
  
  for (let a = -spreadRad / 2; a <= spreadRad / 2; a += spreadRad / 15) {
    const dx = radius * Math.sin(angleRad + a);
    const dy = radius * Math.cos(angleRad + a);
    const dLat = dy / 111111;
    const dLng = dx / (111111 * Math.cos((lat * Math.PI) / 180));
    points.push([lat + dLat, lng + dLng]);
  }
  
  return points;
}

// ============================================================================
// MODUL: WINDDATEN (√ºberarbeitet)
// ============================================================================
function getWindDirection(degrees) {
  const dirs = ['N', 'NO', 'O', 'SO', 'S', 'SW', 'W', 'NW'];
  return dirs[Math.round(((degrees % 360) / 45)) % 8];
}

async function updateWindData(force = false) {
  // nur alle 10min (600.000 ms) ‚Äî au√üer force=true
  if (!force && Date.now() - lastWindUpdate < 600000) return;
  if (!userPosition) return;
  
  try {
    const response = await fetch(
      `https://api.brightsky.dev/current_weather?lat=${userPosition.lat}&lon=${userPosition.lng}`,
      { cache: 'no-store' }
    );
    
    if (!response.ok) throw new Error('API-Fehler ' + response.status);
    
    const data = await response.json();
    
    if (data.weather && data.weather[0]) {
      const w = data.weather[0];
      const speed = Number.isFinite(w.wind_speed) ? Math.round(w.wind_speed) : null;
      const degrees = Number.isFinite(w.wind_direction) ? Math.round(w.wind_direction) : null;

      windData.speed = speed;
      windData.degrees = degrees;
      windData.direction = degrees !== null ? getWindDirection(degrees) : null;
      
      // Update UI
      document.getElementById('wind-value').textContent = 
        (speed !== null && degrees !== null)
          ? `${speed} km/h aus ${windData.direction} (${degrees}¬∞)`
          : `-- km/h`;
      
      // Wind-Pfeil aktualisieren
      updateWindArrow();
    }
    
    lastWindUpdate = Date.now();
  } catch (error) {
    // Silent fail - Wind ist nice-to-have
    console.log('Wind-Daten nicht verf√ºgbar:', error);
  }
}

function updateWindArrow() {
  if (!userPosition || windData.degrees === null || windData.speed === null) return;
  
  // Alten Pfeil entfernen
  if (windArrow) {
    map.removeLayer(windArrow);
    windArrow = null;
  }
  
  // Nur anzeigen wenn Wind > 5 km/h
  if (windData.speed < 5) return;
  
  // Farbe nach Windst√§rke
  const windColor = windData.speed > 30 ? '#ff0000' :    // Rot: Sturm
                     windData.speed > 20 ? '#ff9800' :    // Orange: Starkwind  
                     windData.speed > 10 ? '#2196F3' :    // Blau: M√§√üig
                                           '#4CAF50';      // Gr√ºn: Schwach
  
  // Pfeil-Polygon erstellen (zeigt woher Wind kommt)
  windArrow = L.polygon(
    getWindArrowPoints([userPosition.lat, userPosition.lng], windData.degrees),
    {
      color: windColor,
      fillColor: windColor,
      fillOpacity: 0.4,
      weight: 2
    }
  ).addTo(map);
  
  // Tooltip mit Wind-Info
  windArrow.bindTooltip(
    `Wind: ${windData.speed} km/h aus ${windData.direction} (${windData.degrees}¬∞)`, 
    {
      permanent: false,
      direction: 'top'
    }
  );
}

function getWindArrowPoints(center, windFromDeg, length = 60) {
  const [lat, lng] = center;
  const rad = (windFromDeg * Math.PI) / 180;
  
  // Pfeilspitze (woher Wind kommt) ‚Äì etwas vom Nutzer weg
  const tip_lat = lat + (length * Math.cos(rad)) / 111111;
  const tip_lng = lng + (length * Math.sin(rad)) / (111111 * Math.cos(lat * Math.PI / 180));
  
  // Pfeil-Form (Dreieck)
  const baseOffset = 0.55;        // Breite
  const baseLengthFactor = 0.55;  // Basis bei 55% der L√§nge
  
  const base1_lat = lat + (length * baseLengthFactor * Math.cos(rad - baseOffset)) / 111111;
  const base1_lng = lng + (length * baseLengthFactor * Math.sin(rad - baseOffset)) / (111111 * Math.cos(lat * Math.PI / 180));
  
  const base2_lat = lat + (length * baseLengthFactor * Math.cos(rad + baseOffset)) / 111111;
  const base2_lng = lng + (length * baseLengthFactor * Math.sin(rad + baseOffset)) / (111111 * Math.cos(lat * Math.PI / 180));
  
  return [
    [tip_lat, tip_lng],     // Spitze
    [base1_lat, base1_lng], // Basis links
    [base2_lat, base2_lng]  // Basis rechts
  ];
}

// ============================================================================
// MODUL: KOMPASS (mit Himmelsrichtungen)
// ============================================================================
function toggleCompass() {
  if (!compassActive) {
    requestCompassPermission();
  } else {
    compassActive = false;
    document.getElementById('compass-toggle').classList.remove('active');
    // Event Listener entfernen
    if (orientationHandler) {
      window.removeEventListener('deviceorientation', orientationHandler);
      window.removeEventListener('deviceorientationabsolute', orientationHandler);
      orientationHandler = null;
    }
  }
}

function requestCompassPermission() {
  if (typeof DeviceOrientationEvent !== "undefined" && 
      typeof DeviceOrientationEvent.requestPermission === "function") {
    
    DeviceOrientationEvent.requestPermission()
      .then(permissionState => {
        if (permissionState === "granted") {
          setupOrientationListener();
          compassActive = true;
          document.getElementById('compass-toggle').classList.add('active');
        } else {
          alert('Kompass-Berechtigung verweigert');
        }
      })
      .catch(console.error);
  } else {
    setupOrientationListener();
    compassActive = true;
    document.getElementById('compass-toggle').classList.add('active');
  }
}

function setupOrientationListener() {
  orientationHandler = function(event) {
    if (!compassActive) return;
    
    let heading = null;
    
    if (isIOS && event.webkitCompassHeading !== undefined) {
      heading = event.webkitCompassHeading;
    } else if (event.alpha !== null) {
      heading = 360 - event.alpha;
      if (heading >= 360) heading -= 360;
      if (heading < 0) heading += 360;
    }
    
    if (heading !== null) {
      updateHeading(heading);
    }
  };
  
  if (window.DeviceOrientationEvent) {
    window.addEventListener('deviceorientation', orientationHandler, true);
    
    if ('ondeviceorientationabsolute' in window) {
      window.addEventListener('deviceorientationabsolute', orientationHandler, true);
    }
  }
}

// Grad ‚Üí Himmelsrichtung (8er-Teilung)
function degreesToCardinal(deg) {
  const dirs = ['N', 'NO', 'O', 'SO', 'S', 'SW', 'W', 'NW'];
  return dirs[Math.round(((deg % 360) / 45)) % 8];
}

function updateHeading(heading) {
  currentHeading = (heading + 360) % 360;
  
  // Grad-Anzeige mit Himmelsrichtung (z.B. "73¬∞ (NO)")
  const dir = degreesToCardinal(currentHeading);
  document.getElementById('degree-value').textContent = `${Math.round(currentHeading)}¬∞ (${dir})`;
  
  // Richtungskegel aktualisieren
  if (cone && userPosition) {
    cone.setLatLngs(getConePoints([userPosition.lat, userPosition.lng], currentHeading));
  }
}

// ============================================================================
// MODUL: N√ÑCHSTER HYDRANT (MIT 15 SEK TIMER)
// ============================================================================
function findNearestHydrant() {
  if (!userPosition) {
    alert('Position noch nicht verf√ºgbar. Bitte warten Sie auf GPS-Signal.');
    return;
  }
  
  // Alte Timer und Linien clearen
  if (hydrantLineTimer) {
    clearTimeout(hydrantLineTimer);
    hydrantLineTimer = null;
  }
  
  if (nearestHydrantLine) {
    map.removeLayer(nearestHydrantLine);
    nearestHydrantLine = null;
  }
  
  let nearest = null;
  let minDistance = Infinity;
  
  hydrantMarkers.forEach(marker => {
    // Nur sichtbare Marker ber√ºcksichtigen
    if (map.hasLayer(marker)) {
      const hydrantPos = marker.getLatLng();
      const distance = calculateDistance(
        userPosition.lat, userPosition.lng,
        hydrantPos.lat, hydrantPos.lng
      );
      
      if (distance < minDistance) {
        minDistance = distance;
        nearest = marker;
      }
    }
  });
  
  if (nearest) {
    map.setView(nearest.getLatLng(), 18);
    nearest.openPopup();
    
    // Linie zum n√§chsten Hydranten mit Pfeilspitze
    nearestHydrantLine = L.polyline([
      [userPosition.lat, userPosition.lng],
      nearest.getLatLng()
    ], {
      color: '#4CAF50',
      weight: 3,
      opacity: 0.8,
      dashArray: '10, 5'
    }).addTo(map).bindPopup(`‚Üí Entfernung: ${Math.round(minDistance)} m`);
    
    // Nach 15 Sekunden automatisch entfernen
    hydrantLineTimer = setTimeout(() => {
      if (nearestHydrantLine) {
        map.removeLayer(nearestHydrantLine);
        nearestHydrantLine = null;
      }
      hydrantLineTimer = null;
    }, 15000);
  } else {
    alert('Keine Hydranten in der N√§he gefunden.');
  }
}

function calculateDistance(lat1, lng1, lat2, lng2) {
  const R = 6371000;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLng/2) * Math.sin(dLng/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

// ============================================================================
// MODUL: SCREENSHOT/TEILEN
// ============================================================================
function captureScreenshot() {
  if (navigator.share) {
    navigator.share({
      title: 'üöí Hydrantenkarte Position',
      text: `Position: ${userPosition ? userPosition.lat.toFixed(6) + ', ' + userPosition.lng.toFixed(6) : 'unbekannt'}\nRichtung: ${Math.round(currentHeading)}¬∞ (${degreesToCardinal(currentHeading)})${windData.speed ? '\nWind: ' + windData.speed + ' km/h aus ' + getWindDirection(windData.degrees) + ' (' + windData.degrees + '¬∞)' : ''}`,
      url: window.location.href
    }).catch(console.error);
  } else {
    const coords = userPosition ? 
      `Position: ${userPosition.lat.toFixed(6)}, ${userPosition.lng.toFixed(6)}\nRichtung: ${Math.round(currentHeading)}¬∞ (${degreesToCardinal(currentHeading)})${windData.speed ? '\nWind: ' + windData.speed + ' km/h aus ' + getWindDirection(windData.degrees) + ' (' + windData.degrees + '¬∞)' : ''}` : 
      'Position unbekannt';
    
    if (navigator.clipboard) {
      navigator.clipboard.writeText(coords).then(() => {
        alert('Position in Zwischenablage kopiert:\n' + coords);
      });
    } else {
      alert(coords);
    }
  }
}

// ============================================================================
// MODUL: OFFLINE-MANAGEMENT
// ============================================================================
window.addEventListener('online', () => {
  isOffline = false;
  document.getElementById('offline-indicator').classList.remove('visible');
});

window.addEventListener('offline', () => {
  isOffline = true;
  document.getElementById('offline-indicator').classList.add('visible');
});

if (!navigator.onLine) {
  document.getElementById('offline-indicator').classList.add('visible');
}

// ============================================================================
// MODUL: PAGE VISIBILITY (Battery-Schonung)
// ============================================================================
document.addEventListener('visibilitychange', () => {
  if (document.hidden && watchId) {
    // App im Hintergrund - GPS pausieren
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  } else if (!document.hidden && !watchId) {
    // App wieder aktiv - GPS reaktivieren
    startLocationTracking();
  }
});

// ============================================================================
// MODUL: EVENT LISTENER & CLEANUP
// ============================================================================
window.addEventListener('beforeunload', function() {
  if (watchId) {
    navigator.geolocation.clearWatch(watchId);
  }
  
  if (flashlightStream) {
    flashlightStream.getTracks().forEach(track => track.stop());
  }
  
  if (orientationHandler) {
    window.removeEventListener('deviceorientation', orientationHandler);
    window.removeEventListener('deviceorientationabsolute', orientationHandler);
  }
});

// ============================================================================
// MODUL: INITIALISIERUNG
// ============================================================================
window.addEventListener('load', function() {
  // GPS automatisch starten
  startLocationTracking();

  // Wind regelm√§√üig aktualisieren (alle 10 Minuten)
  setInterval(() => updateWindData(false), 600000);
  
  // Kompass nach kurzer Verz√∂gerung anbieten
  setTimeout(() => {
    if (isIOS || confirm('Kompass aktivieren f√ºr bessere Navigation?')) {
      toggleCompass();
    }
  }, 1500);
  
  // Legende initial einklappen auf Mobile
  if (window.innerWidth < 768) {
    setTimeout(() => {
      toggleLegend();
    }, 500);
  }
});

// ============================================================================
// MODUL: RESPONSIVE ANPASSUNGEN
// ============================================================================
window.addEventListener('resize', () => {
  if (map) {
    map.invalidateSize();
  }
});

window.addEventListener('orientationchange', () => {
  setTimeout(() => {
    if (map) {
      map.invalidateSize();
    }
  }, 500);
});

</script>
</body>
</html>